<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GenLife - Smart Wardrobe</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>G</text></svg>">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: #000; 
      color: #fff; 
      overflow-x: hidden;
    }
    
    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: opacity 0.5s;
    }
    .loading-screen.hidden { opacity: 0; pointer-events: none; }
    .loading-quote {
      font-size: 1.5rem;
      text-align: center;
      max-width: 600px;
      padding: 2rem;
      font-style: italic;
      opacity: 0.9;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #fff;
      border-top-color: #ff006e;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Login Screen */
    .login-screen { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      min-height: 100vh; 
      padding: 2rem; 
      background: linear-gradient(135deg, #667eea, #764ba2);
    }
    .login-card { 
      background: rgba(0,0,0,0.8); 
      padding: 2rem; 
      border-radius: 20px; 
      width: 100%; 
      max-width: 400px; 
      backdrop-filter: blur(10px); 
      border: 1px solid rgba(255,255,255,0.1);
    }
    .login-logo { 
      text-align: center; 
      font-size: 3rem; 
      margin-bottom: 1rem; 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent; 
    }
    .login-title { 
      text-align: center; 
      font-size: 1.5rem; 
      margin-bottom: 2rem; 
      font-weight: 600;
    }
    .login-input { 
      width: 100%; 
      padding: 1rem; 
      margin-bottom: 1rem; 
      background: rgba(255,255,255,0.1); 
      border: 1px solid rgba(255,255,255,0.2); 
      border-radius: 12px; 
      color: white; 
      font-size: 1rem;
    }
    .login-input::placeholder { color: rgba(255,255,255,0.7); }
    .login-input:focus { 
      outline: none; 
      border-color: #ff006e; 
      box-shadow: 0 0 0 2px rgba(255,0,110,0.2);
    }
    .login-btn { 
      width: 100%; 
      padding: 1rem; 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      border: none; 
      border-radius: 12px; 
      color: white; 
      font-size: 1rem; 
      font-weight: 600; 
      cursor: pointer; 
      transition: transform 0.2s;
    }
    .login-btn:hover { transform: scale(1.02); }
    
    /* Main App */
    .app { display: none; }
    .app.active { display: block; }
    
    /* Header */
    .header { 
      position: fixed; 
      top: 0; 
      width: 100%; 
      height: 60px; 
      background: rgba(0,0,0,0.9); 
      backdrop-filter: blur(10px); 
      z-index: 100; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 0 1rem;
      border-bottom: 1px solid #333;
    }
    .logo { 
      font-size: 1.2rem; 
      font-weight: 700; 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent; 
    }
    .user-info { 
      display: flex; 
      align-items: center; 
      gap: 0.5rem; 
      font-size: 0.9rem;
    }
    .logout-btn { 
      background: #333; 
      border: none; 
      color: white; 
      padding: 0.5rem 1rem; 
      border-radius: 8px; 
      cursor: pointer; 
      font-size: 0.8rem;
    }
    
    /* Weather Banner */
    .weather-banner {
      background: linear-gradient(135deg, #667eea, #764ba2);
      padding: 0.75rem 1rem;
      text-align: center;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    /* Main Content */
    .main { padding-top: 60px; padding-bottom: 80px; min-height: 100vh; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Explore Feed Styles */
    .feed-container { max-width: 500px; margin: 0 auto; padding: 1rem; }
    .post { 
      background: #111; 
      margin: 1rem 0; 
      border-radius: 12px; 
      overflow: hidden;
      border: 1px solid #333;
    }
    .post-header { 
      display: flex; 
      align-items: center; 
      padding: 1rem; 
      gap: 0.75rem; 
    }
    .avatar { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: bold; 
      color: white;
    }
    .post-user { font-weight: 600; }
    .post-time { color: #888; font-size: 0.85rem; }
    .post-outfit { 
      padding: 0 1rem; 
      font-size: 1.1rem; 
      line-height: 1.4; 
      margin-bottom: 0.5rem;
    }
    .post-purchase {
      padding: 0 1rem 1rem;
      font-size: 0.9rem;
      color: #888;
    }
    .post-purchase a {
      color: #ff006e;
      text-decoration: none;
    }
    
    /* Image Upload Styles */
    .post-image-container { 
      position: relative;
      height: 300px; 
      margin: 0 1rem 1rem 1rem; 
      border-radius: 8px;
      overflow: hidden;
    }
    .post-image { 
      width: 100%;
      height: 100%; 
      object-fit: cover;
      background: linear-gradient(135deg, #667eea, #764ba2); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 4rem; 
    }
    .upload-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: opacity 0.3s;
    }
    .upload-overlay:hover { opacity: 0.9; }
    .upload-text { margin-top: 1rem; font-size: 1rem; }
    
    .post-actions { 
      display: flex; 
      justify-content: space-between; 
      padding: 0 1rem 1rem; 
      align-items: center;
    }
    .action-buttons { display: flex; gap: 1rem; }
    .action-btn { 
      background: none; 
      border: none; 
      color: #fff; 
      font-size: 1.2rem; 
      cursor: pointer; 
      transition: transform 0.1s;
    }
    .action-btn:hover { transform: scale(1.1); }
    .action-btn.rated { color: #fbbf24; }
    .post-stats { color: #888; font-size: 0.85rem; }
    
    /* Star Rating */
    .star-rating {
      display: flex;
      gap: 0.25rem;
    }
    .star {
      cursor: pointer;
      font-size: 1.2rem;
      color: #666;
      transition: color 0.2s;
    }
    .star.active {
      color: #fbbf24;
    }
    
    /* Comments Section */
    .comments-section {
      padding: 1rem;
      border-top: 1px solid #333;
      background: rgba(255,255,255,0.05);
    }
    .comment {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(45deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .comment-content {
      flex: 1;
    }
    .comment-header {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.25rem;
    }
    .comment-user {
      font-weight: 600;
      font-size: 0.9rem;
    }
    .comment-time {
      color: #888;
      font-size: 0.75rem;
    }
    .comment-text {
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .add-comment {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .comment-input {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: 1px solid #444;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      color: white;
      font-size: 0.9rem;
    }
    .comment-input:focus {
      outline: none;
      border-color: #ff006e;
    }
    .comment-btn {
      background: #ff006e;
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    /* Edit Post */
    .edit-post {
      padding: 1rem;
      border-top: 1px solid #333;
      background: rgba(255,255,255,0.05);
    }
    .edit-input {
      width: 100%;
      background: rgba(255,255,255,0.1);
      border: 1px solid #444;
      border-radius: 8px;
      padding: 0.75rem;
      color: white;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    .edit-input:focus {
      outline: none;
      border-color: #ff006e;
    }
    .edit-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }
    
    /* Create Post */
    .create-post { 
      background: #111; 
      border-radius: 12px; 
      padding: 1rem; 
      margin: 1rem 0; 
      border: 1px solid #333;
    }
    .post-input { 
      width: 100%; 
      background: transparent; 
      border: none; 
      color: white; 
      padding: 0.5rem 0; 
      font-size: 1rem; 
      resize: none;
    }
    .post-input:focus { outline: none; }
    .image-upload {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
      padding: 1rem;
      border: 2px dashed #444;
      border-radius: 8px;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    .image-upload:hover { border-color: #ff006e; }
    .image-upload input[type="file"] { display: none; }
    .post-btn { 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      border: none; 
      color: white; 
      padding: 0.5rem 1rem; 
      border-radius: 8px; 
      cursor: pointer; 
      font-size: 0.9rem; 
      margin-top: 0.5rem;
    }
    
    /* Community Section */
    .community-container { max-width: 600px; margin: 0 auto; padding: 1rem; }
    .community-header {
      background: linear-gradient(45deg, #ff006e, #8338ec);
      padding: 2rem;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    /* Leaderboard Styles */
    .leaderboard-section {
      background: #111;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid #333;
    }
    .leaderboard-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }
    .leaderboard-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
    }
    .leaderboard-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      text-align: center;
    }
    .leaderboard-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid #333;
    }
    .leaderboard-item:last-child {
      border-bottom: none;
    }
    .rank {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #ff006e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .rank-1 { background: #ffd700; color: #000; }
    .rank-2 { background: #c0c0c0; color: #000; }
    .rank-3 { background: #cd7f32; color: #000; }
    .trending-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0;
    }
    .trending-icon {
      font-size: 1.5rem;
    }
    .trending-name {
      flex: 1;
      font-weight: 500;
    }
    .trending-count {
      color: #888;
      font-size: 0.85rem;
    }
    .view-full-btn {
      width: 100%;
      margin-top: 1rem;
      background: #333;
      color: white;
      border: none;
      padding: 0.75rem;
      border-radius: 8px;
      cursor: pointer;
    }
    
    /* Map Styles */
    .map-container {
      max-width: 100%;
      padding: 1rem;
    }
    .map-header {
      background: #111;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      text-align: center;
    }
    .map-view {
      height: 400px;
      border-radius: 12px;
      border: 1px solid #333;
    }
    .leaflet-popup-content {
      color: #000;
      max-width: 200px;
    }
    .delete-marker-btn {
      background: #ef4444;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 0.5rem;
      width: 100%;
    }
    
    /* Bottom Navigation */
    .bottom-nav { 
      position: fixed; 
      bottom: 0; 
      width: 100%; 
      height: 70px; 
      background: rgba(0,0,0,0.95); 
      backdrop-filter: blur(10px); 
      display: flex; 
      justify-content: space-around; 
      align-items: center; 
      border-top: 1px solid #333; 
      z-index: 100;
    }
    .nav-item { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      cursor: pointer; 
      transition: all 0.2s; 
      padding: 0.5rem;
    }
    .nav-item.active { color: #ff006e; }
    .nav-icon { font-size: 1.4rem; margin-bottom: 0.25rem; }
    .nav-label { font-size: 0.7rem; font-weight: 500; }
    
    /* Profile Tab Styles */
    .tab-container { padding: 1rem; max-width: 500px; margin: 0 auto; }
    .card { 
      background: #111; 
      border-radius: 12px; 
      padding: 1.5rem; 
      margin: 1rem 0; 
      border: 1px solid #333;
    }
    .card h2 { margin-bottom: 1rem; }
    .form-row { 
      display: flex; 
      gap: 0.5rem; 
      margin-bottom: 1rem; 
      flex-wrap: wrap;
    }
    input, select, textarea { 
      background: #222; 
      border: 1px solid #444; 
      color: #fff; 
      padding: 0.75rem; 
      border-radius: 8px; 
      flex: 1; 
      min-width: 120px;
    }
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: #ff006e; 
      box-shadow: 0 0 0 2px rgba(255,0,110,0.2);
    }
    .btn { 
      background: linear-gradient(45deg, #ff006e, #8338ec); 
      border: none; 
      color: white; 
      padding: 0.75rem 1.5rem; 
      border-radius: 8px; 
      cursor: pointer; 
      font-weight: 600; 
      transition: transform 0.1s;
    }
    .btn:hover { transform: scale(1.05); }
    .btn.secondary { background: #333; }
    .btn.small { padding: 0.5rem 1rem; font-size: 0.85rem; }
    .btn.danger { background: #ef4444; }
    
    /* Dashboard Styles */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .dashboard-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
    }
    .dashboard-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .dashboard-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .wardrobe-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
      gap: 1rem;
    }
    .wardrobe-item { 
      background: #111; 
      border: 1px solid #333; 
      border-radius: 8px; 
      padding: 1rem; 
      text-align: center;
      position: relative;
    }
    .item-icon { font-size: 2rem; margin-bottom: 0.5rem; }
    .item-image {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .item-name { font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; }
    .item-details { font-size: 0.75rem; color: #888; margin-bottom: 0.5rem; }
    .item-category {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(0,0,0,0.7);
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.7rem;
    }
    .item-color {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: rgba(0,0,0,0.7);
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.7rem;
    }
    .wear-count {
      background: #ff006e;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.7rem;
      margin-top: 0.5rem;
      display: inline-block;
    }
    
    /* Outfits Section */
    .outfits-section {
      margin-top: 2rem;
    }
    .outfit-combination {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    .outfit-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .outfit-name {
      font-weight: 600;
      font-size: 1.1rem;
    }
    .outfit-wear-count {
      background: #10b981;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.8rem;
    }
    .outfit-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.5rem;
    }
    .outfit-item {
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 0.75rem;
      text-align: center;
    }
    .outfit-item-image {
      width: 100%;
      height: 60px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }
    .outfit-item-name {
      font-size: 0.8rem;
      font-weight: 500;
    }
    .outfit-item-type {
      font-size: 0.7rem;
      color: #888;
    }
    
    .ai-suggestion { 
      background: linear-gradient(135deg, #ff006e, #8338ec); 
      border-radius: 12px; 
      padding: 2rem; 
      text-align: center; 
      margin: 1rem 0;
    }
    .suggestion-outfit { font-size: 1.2rem; margin: 1rem 0; }
    .suggestion-tip { opacity: 0.9; font-size: 0.9rem; }
    
    /* Calendar Styles */
    .calendar-section {
      margin-top: 2rem;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .calendar-day {
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 0.5rem;
      text-align: center;
      min-height: 60px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .calendar-day:hover {
      background: rgba(255,255,255,0.2);
    }
    .calendar-day.has-event {
      background: rgba(255,0,110,0.3);
      border: 1px solid #ff006e;
    }
    .day-number {
      font-weight: bold;
      margin-bottom: 0.25rem;
    }
    .event-dot {
      width: 6px;
      height: 6px;
      background: #ff006e;
      border-radius: 50%;
      margin: 0 auto;
    }
    .scheduled-outfits {
      margin-top: 1rem;
    }
    .scheduled-outfit {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Shop Categories */
    .shop-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .category-card {
      background: #111;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    .category-card:hover {
      border-color: #ff006e;
      transform: translateY(-2px);
    }
    .category-card.active { border-color: #ff006e; background: rgba(255,0,110,0.1); }
    .category-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
    .category-name { font-weight: 600; }
    
    /* African Heritage Categories */
    .heritage-section {
      background: linear-gradient(135deg, #d4af37, #ffd700);
      color: #000;
      padding: 2rem;
      border-radius: 12px;
      margin: 2rem 0;
      text-align: center;
    }
    .heritage-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
    .heritage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .heritage-item {
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 1.5rem;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .heritage-item:hover { transform: scale(1.05); }
    .heritage-icon { font-size: 2rem; margin-bottom: 0.5rem; }
    
    /* Shop Items with Images */
    .shop-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 1rem;
    }
    .shop-item { 
      background: #111; 
      border: 1px solid #333; 
      border-radius: 8px; 
      padding: 1rem;
      text-align: center;
      transition: transform 0.2s;
    }
    .shop-item:hover {
      transform: translateY(-2px);
      border-color: #ff006e;
    }
    .shop-item-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .shop-icon { 
      font-size: 2rem; 
      margin-bottom: 0.5rem; 
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .shop-name { 
      font-weight: 600; 
      margin-bottom: 0.25rem; 
      font-size: 0.9rem;
    }
    .shop-price { 
      color: #4ade80; 
      font-weight: 600; 
      font-size: 0.85rem;
    }
    .shop-store { 
      color: #888; 
      font-size: 0.75rem; 
      margin-bottom: 0.5rem;
    }
    
    /* Merchant Login */
    .merchant-login {
      background: linear-gradient(135deg, #10b981, #059669);
      color: #000;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .notification { 
      position: fixed; 
      top: 80px; 
      right: 20px; 
      background: #10b981; 
      color: white; 
      padding: 0.75rem 1rem; 
      border-radius: 8px; 
      z-index: 1000; 
      transform: translateX(400px); 
      transition: transform 0.3s ease;
    }
    .notification.show { transform: translateX(0); }
    .notification.error { background: #ef4444; }
    
    .empty-state { 
      text-align: center; 
      padding: 3rem 1rem; 
      color: #666;
    }
    
    @media (max-width: 768px) {
      .form-row { flex-direction: column; }
      .wardrobe-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      .shop-categories { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      .heritage-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
      .shop-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
      .dashboard-grid { grid-template-columns: 1fr; }
      .leaderboard-grid { grid-template-columns: 1fr; }
      .outfit-items { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-quote" id="loading-quote"></div>
  </div>

  <!-- Login Screen -->
  <div id="login-screen" class="login-screen">
    <div class="login-card">
      <div class="login-logo">‚ú®üëî</div>
      <h1 class="login-title">GenLife</h1>
      <input type="text" id="username" class="login-input" placeholder="Enter your name" />
      <select id="user-location" class="login-input">
        <option value="Nairobi">üìç Nairobi</option>
        <option value="Mombasa">üìç Mombasa</option>
        <option value="Kisumu">üìç Kisumu</option>
        <option value="Nakuru">üìç Nakuru</option>
        <option value="Eldoret">üìç Eldoret</option>
      </select>
      <div class="merchant-login">
        <p><strong>Merchant Login</strong></p>
        <button class="login-btn" onclick="loginAsMerchant()">Login as Merchant</button>
      </div>
      <button class="login-btn" onclick="login()">Start Styling ‚ú®</button>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="app">
    <header class="header">
      <div class="logo">‚ú® GenLife</div>
      <div class="user-info">
        <span id="current-user">üë§ User</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </header>

    <main class="main">
      <!-- Explore Tab -->
      <div id="explore-tab" class="tab-content active">
        <div class="weather-banner" id="weather-banner">
          Loading weather...
        </div>
        <div class="feed-container">
          <div class="create-post">
            <textarea id="outfit-input" class="post-input" placeholder="Share your outfit today..."></textarea>
            <input type="text" id="purchase-info" class="post-input" placeholder="Where did you buy these items? (optional)">
            <label class="image-upload" for="image-upload-input">
              <input type="file" id="image-upload-input" accept="image/*" onchange="handleImageUpload(event)">
              üì∑ Add Photo
            </label>
            <canvas id="image-canvas" style="display:none;"></canvas>
            <button class="post-btn" onclick="createPost()">Share Outfit</button>
          </div>
          <div id="posts-container"></div>
        </div>
      </div>

      <!-- Community Tab -->
      <div id="community-tab" class="tab-content">
        <div class="community-container">
          <div class="community-header">
            <h1>Fashion Community Hub</h1>
            <p>Celebrating African fashion excellence</p>
          </div>
          
          <div class="leaderboard-section">
            <h3>üèÜ Style Champions</h3>
            <div class="leaderboard-grid">
              <div class="leaderboard-card">
                <div class="leaderboard-title">Top Fashionistas</div>
                <div id="winners-leaderboard"></div>
                <button class="view-full-btn" onclick="showFullLeaderboard()">View Full Leaderboard</button>
              </div>
              <div class="leaderboard-card">
                <div class="leaderboard-title">üî• Trending Styles</div>
                <div id="trending-styles"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Shop Tab -->
      <div id="shop-tab" class="tab-content">
        <div class="tab-container">
          <div class="card">
            <h2>üõçÔ∏è Fashion Marketplace</h2>
            <div id="merchant-controls" style="display: none;">
              <div class="form-row">
                <input type="text" id="new-item-name" placeholder="Item name">
                <select id="new-item-category">
                  <option value="top">üëï Top</option>
                  <option value="bottom">üëñ Bottom</option>
                  <option value="dress">üëó Dress</option>
                  <option value="shoes">üëü Shoes</option>
                  <option value="outerwear">üß• Outerwear</option>
                  <option value="accessory">üíé Accessory</option>
                  <option value="cologne">üå¨Ô∏è Cologne</option>
                </select>
                <select id="new-item-price">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
                <button class="btn" onclick="addShopItem()">Add Item</button>
              </div>
            </div>
            <div class="form-row">
              <input type="text" id="search-input" placeholder="Search for items...">
              <button class="btn" onclick="searchShop()">Search</button>
            </div>
          </div>

          <div class="heritage-section">
            <div class="heritage-title">üåç African Heritage Collection</div>
            <p>Celebrate your roots with authentic African fashion</p>
            <div class="heritage-grid">
              <div class="heritage-item" onclick="filterShop('kente')">
                <div class="heritage-icon">üü®üü´</div>
                <div>Kente Accessories</div>
              </div>
              <div class="heritage-item" onclick="filterShop('dashiki')">
                <div class="heritage-icon">üëî</div>
                <div>Modern Dashiki</div>
              </div>
              <div class="heritage-item" onclick="filterShop('ankara')">
                <div class="heritage-icon">üß•</div>
                <div>Ankara Blazers</div>
              </div>
              <div class="heritage-item" onclick="filterShop('djellaba')">
                <div class="heritage-icon">ü•ª</div>
                <div>Djellaba & Caftan</div>
              </div>
              <div class="heritage-item" onclick="filterShop('jewelry')">
                <div class="heritage-icon">üìø</div>
                <div>Beaded Jewelry</div>
              </div>
              <div class="heritage-item" onclick="filterShop('cologne')">
                <div class="heritage-icon">üå¨Ô∏è</div>
                <div>Colognes</div>
              </div>
            </div>
          </div>

          <div class="shop-categories" id="shop-categories">
            <div class="category-card active" onclick="filterShop('all')">
              <div class="category-icon">üõçÔ∏è</div>
              <div class="category-name">All Items</div>
            </div>
            <div class="category-card" onclick="filterShop('top')">
              <div class="category-icon">üëï</div>
              <div class="category-name">Tops</div>
            </div>
            <div class="category-card" onclick="filterShop('bottom')">
              <div class="category-icon">üëñ</div>
              <div class="category-name">Bottoms</div>
            </div>
            <div class="category-card" onclick="filterShop('dress')">
              <div class="category-icon">üëó</div>
              <div class="category-name">Dresses</div>
            </div>
            <div class="category-card" onclick="filterShop('shoes')">
              <div class="category-icon">üëü</div>
              <div class="category-name">Shoes</div>
            </div>
            <div class="category-card" onclick="filterShop('outerwear')">
              <div class="category-icon">üß•</div>
              <div class="category-name">Outerwear</div>
            </div>
            <div class="category-card" onclick="filterShop('cologne')">
              <div class="category-icon">üå¨Ô∏è</div>
              <div class="category-name">Colognes</div>
            </div>
          </div>

          <div id="shop-results" class="shop-grid"></div>
        </div>
      </div>

      <!-- AI Dresser Tab -->
      <div id="ai-dresser-tab" class="tab-content">
        <div class="tab-container">
          <div class="card">
            <h2>ü§ñ AI Dresser</h2>
            <div class="form-row">
              <select id="occasion">
                <option value="casual">üòé Casual</option>
                <option value="work">üíº Work</option>
                <option value="date">‚ù§Ô∏è Date Night</option>
                <option value="event">üéâ Special Event</option>
                <option value="cultural">üåç Cultural Event</option>
              </select>
              <button class="btn" onclick="getAIRecommendation()">‚ú® Get Suggestion</button>
            </div>
          </div>
          <div id="ai-result">
            <div class="ai-suggestion">
              <h3>‚ú® AI is ready to help!</h3>
              <div class="suggestion-outfit">Add some items to your wardrobe and get personalized outfit suggestions</div>
              <div class="suggestion-tip">üí° The more items you have, the better the suggestions!</div>
            </div>
          </div>

          <!-- Shop Suggestions -->
          <div class="card">
            <h2>üõçÔ∏è Shop Suggestions</h2>
            <div class="form-row">
              <select id="shop-occasion">
                <option value="casual">üòé Casual</option>
                <option value="work">üíº Work</option>
                <option value="date">‚ù§Ô∏è Date Night</option>
                <option value="event">üéâ Special Event</option>
                <option value="cultural">üåç Cultural Event</option>
              </select>
              <select id="shop-weather">
                <option value="hot">üî• Hot</option>
                <option value="warm">‚òÄÔ∏è Warm</option>
                <option value="mild">üå§Ô∏è Mild</option>
                <option value="cool">‚ùÑÔ∏è Cool</option>
              </select>
              <button class="btn" onclick="getShopSuggestions()">Find Items</button>
            </div>
            <div id="shop-suggestions" class="shop-grid" style="margin-top: 1rem;"></div>
          </div>

          <!-- Wardrobe Scheduler -->
          <div class="card calendar-section">
            <h2>üìÖ My Schedule</h2>
            <div class="calendar-header">
              <button class="btn secondary" onclick="previousMonth()">‚Üê</button>
              <h3 id="current-month">January 2024</h3>
              <button class="btn secondary" onclick="nextMonth()">‚Üí</button>
            </div>
            <div class="calendar-grid" id="calendar-grid"></div>
            <div class="scheduled-outfits" id="scheduled-outfits">
              <h4>Today's Outfits</h4>
              <div id="todays-outfits"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Tab -->
      <div id="profile-tab" class="tab-content">
        <div class="tab-container">
          <!-- Dashboard -->
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="dashboard-number" id="total-items">0</div>
              <div class="dashboard-label">Wardrobe Items</div>
            </div>
            <div class="dashboard-card">
              <div class="dashboard-number" id="total-outfits">0</div>
              <div class="dashboard-label">Created Outfits</div>
            </div>
          </div>

          <!-- Add Item Section -->
          <div class="card">
            <h2>üëî Add Wardrobe Item</h2>
            <div class="form-row">
              <input id="item-name" placeholder="Item name" />
              <select id="item-category">
                <option value="top">üëï Top</option>
                <option value="bottom">üëñ Bottom</option>
                <option value="dress">üëó Dress</option>
                <option value="shoes">üëü Shoes</option>
                <option value="outerwear">üß• Outerwear</option>
                <option value="cologne">üå¨Ô∏è Cologne</option>
                <option value="accessory">üíé Accessory</option>
              </select>
              <select id="item-color">
                <option value="white">White</option>
                <option value="black">Black</option>
                <option value="blue">Blue</option>
                <option value="red">Red</option>
                <option value="green">Green</option>
                <option value="yellow">Yellow</option>
                <option value="neutral">Neutral</option>
              </select>
              <label class="image-upload" for="wardrobe-image-upload">
                <input type="file" id="wardrobe-image-upload" accept="image/*" onchange="handleWardrobeImageUpload(event)">
                üì∑ Add Item Photo
              </label>
            </div>
            <canvas id="wardrobe-image-canvas" style="display:none;"></canvas>
            <button class="btn" onclick="addWardrobeItem()">Add Item</button>
          </div>

          <!-- Create Outfit Section -->
          <div class="card outfits-section">
            <h2>üé® Create Outfit Combination</h2>
            <div class="form-row">
              <select id="outfit-top">
                <option value="">Select Top</option>
              </select>
              <select id="outfit-bottom">
                <option value="">Select Bottom</option>
              </select>
              <select id="outfit-shoes">
                <option value="">Select Shoes</option>
              </select>
            </div>
            <div class="form-row">
              <select id="outfit-outerwear">
                <option value="">Select Outerwear (Optional)</option>
              </select>
              <select id="outfit-accessory">
                <option value="">Select Accessory (Optional)</option>
              </select>
              <select id="outfit-cologne">
                <option value="">Select Cologne (Optional)</option>
              </select>
            </div>
            <input type="text" id="outfit-name" placeholder="Name this outfit (e.g., Casual Friday)" class="form-row">
            <button class="btn" onclick="createOutfit()">Create Outfit</button>
          </div>

          <!-- My Outfits Section -->
          <div class="card">
            <h2>üëó My Outfits</h2>
            <div id="outfits-list"></div>
          </div>

          <!-- Wardrobe Items -->
          <div class="card">
            <h2>üëú My Wardrobe Items</h2>
            <div id="wardrobe-list" class="wardrobe-grid"></div>
          </div>
        </div>
      </div>

      <!-- Map Tab -->
      <div id="map-tab" class="tab-content">
        <div class="map-container">
          <div class="map-header">
            <h2>üó∫Ô∏è Style Map</h2>
            <p>See where fashion enthusiasts are sharing their looks</p>
            <button class="btn" onclick="addNewLocation()" style="margin-top: 1rem;">üìç Add New Location</button>
          </div>
          <div class="map-view" id="map-view"></div>
        </div>
      </div>
    </main>

    <nav class="bottom-nav">
      <div class="nav-item active" onclick="switchTab('explore')">
        <div class="nav-icon">üîç</div>
        <div class="nav-label">Explore</div>
      </div>
      <div class="nav-item" onclick="switchTab('community')">
        <div class="nav-icon">üë•</div>
        <div class="nav-label">Community</div>
      </div>
      <div class="nav-item" onclick="switchTab('shop')">
        <div class="nav-icon">üõçÔ∏è</div>
        <div class="nav-label">Shop</div>
      </div>
      <div class="nav-item" onclick="switchTab('ai-dresser')">
        <div class="nav-icon">ü§ñ</div>
        <div class="nav-label">AI Dresser</div>
      </div>
      <div class="nav-item" onclick="switchTab('profile')">
        <div class="nav-icon" id="profile-icon">üë§</div>
        <div class="nav-label">Profile</div>
      </div>
      <div class="nav-item" onclick="switchTab('map')">
        <div class="nav-icon">üó∫Ô∏è</div>
        <div class="nav-label">Map</div>
      </div>
    </nav>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const API = "http://127.0.0.1:5000";
    let currentUser = null;
    let currentTab = 'explore';
    let selectedImage = null;
    let wardrobeImage = null;
    let currentShopFilter = 'all';
    let map = null;
    let isMerchant = false;
    let userOutfits = [];
    let customLocations = [];
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let scheduledOutfits = {};

    // Fashion Quotes for Loading Screen
    const fashionQuotes = [
      "Fashion is what you buy, style is what you do with it. ‚ú®",
      "Dress like you're already famous. üëó",
      "Style is a way to say who you are without speaking. üëî",
      "Fashion fades, but style is eternal. üß•",
      "Life's too short to wear boring clothes. üëü",
      "African fashion tells stories of heritage and pride. üåç",
      "Kente cloth carries the wisdom of generations. üü®üü´",
      "Ankara prints celebrate the vibrancy of African culture. üé®",
      "Traditional beads speak the language of our ancestors. üìø",
      "Modern African fashion honors the past while embracing the future. ‚ú®",
      "Every dashiki tells a story of resilience and beauty. üëî",
      "African elegance is timeless and powerful. üëë",
      "Our prints carry the colors of the savanna and the rhythm of the drum. üåÖ",
      "Cultural fashion is not a trend, it's a legacy. üåü",
      "Wear your heritage with pride and confidence. üí™"
    ];

    // Show loading screen
    function showLoadingScreen() {
      const quoteElement = document.getElementById('loading-quote');
      quoteElement.textContent = fashionQuotes[Math.floor(Math.random() * fashionQuotes.length)];
      document.getElementById('loading-screen').classList.remove('hidden');
    }

    // Hide loading screen
    function hideLoadingScreen() {
      setTimeout(() => {
        document.getElementById('loading-screen').classList.add('hidden');
      }, 2000);
    }

    // Login/Logout Functions
    function login() {
      showLoadingScreen();
      const username = document.getElementById('username').value.trim();
      const location = document.getElementById('user-location').value;
      
      if (!username) {
        showNotification('Please enter your name', 'error');
        hideLoadingScreen();
        return;
      }
      
      currentUser = { 
        name: username, 
        location: location, 
        lat: getLocationCoords(location).lat, 
        lng: getLocationCoords(location).lng,
        initial: username.charAt(0).toUpperCase()
      };
      
      document.getElementById('current-user').textContent = `üë§ ${username}`;
      document.getElementById('profile-icon').textContent = currentUser.initial;
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').classList.add('active');
      
      // Clear previous user's data
      clearUserData();
      
      showNotification(`Welcome ${username}! üéâ`);
      loadInitialData();
      setTimeout(hideLoadingScreen, 2000);
    }

    function loginAsMerchant() {
      showLoadingScreen();
      const username = document.getElementById('username').value.trim() || 'Merchant';
      const location = document.getElementById('user-location').value;
      
      currentUser = { 
        name: username, 
        location: location, 
        lat: getLocationCoords(location).lat, 
        lng: getLocationCoords(location).lng,
        initial: username.charAt(0).toUpperCase()
      };
      isMerchant = true;
      document.getElementById('current-user').textContent = `üë§ ${username} (Merchant)`;
      document.getElementById('profile-icon').textContent = 'üõçÔ∏è';
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').classList.add('active');
      document.getElementById('merchant-controls').style.display = 'block';
      
      // Clear previous user's data
      clearUserData();
      
      showNotification(`Welcome Merchant ${username}! üõçÔ∏è`);
      loadInitialData();
      setTimeout(hideLoadingScreen, 2000);
    }

    function clearUserData() {
      // Clear user-specific data from localStorage
      localStorage.removeItem(`outfits_${currentUser.name}`);
      localStorage.removeItem(`locations_${currentUser.name}`);
      localStorage.removeItem(`scheduled_${currentUser.name}`);
      userOutfits = [];
      customLocations = [];
      scheduledOutfits = {};
    }

    function logout() {
      showLoadingScreen();
      currentUser = null;
      isMerchant = false;
      document.getElementById('app').classList.remove('active');
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('username').value = '';
      document.getElementById('merchant-controls').style.display = 'none';
      document.getElementById('profile-icon').textContent = 'üë§';
      setTimeout(hideLoadingScreen, 2000);
    }

    // Location coordinates for Kenyan cities
    function getLocationCoords(city) {
      const coords = {
        'Nairobi': { lat: -1.2921, lng: 36.8219 },
        'Mombasa': { lat: -4.0435, lng: 39.6682 },
        'Kisumu': { lat: -0.0917, lng: 34.7680 },
        'Nakuru': { lat: -0.3031, lng: 36.0800 },
        'Eldoret': { lat: 0.5143, lng: 35.2698 }
      };
      return coords[city] || coords['Nairobi'];
    }

    // Weather functions
    async function loadWeather() {
      if (!currentUser) return;
      
      try {
        const data = await apiCall(`/api/weather?city=${currentUser.location}`);
        const weatherBanner = document.getElementById('weather-banner');
        const temp = data.temp_c;
        const condition = data.condition;
        
        let suggestion = '';
        if (temp >= 28) suggestion = 'Perfect for light fabrics';
        else if (temp >= 22) suggestion = 'Great for casual wear';
        else if (temp >= 16) suggestion = 'Ideal for layering';
        else suggestion = 'Time for warm clothing';
        
        weatherBanner.innerHTML = `${temp}¬∞C ‚Ä¢ ${condition} ‚Ä¢ ${suggestion}`;
      } catch (error) {
        console.error('Error loading weather:', error);
        document.getElementById('weather-banner').innerHTML = 'Weather information unavailable';
      }
    }

    // Image handling for posts
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showNotification('Please select an image file', 'error');
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        showNotification('Image size must be less than 5MB', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.getElementById('image-canvas');
          const ctx = canvas.getContext('2d');
          
          // Resize image to max 800px width
          const maxWidth = 800;
          const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
          canvas.width = img.width * ratio;
          canvas.height = img.height * ratio;
          
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          selectedImage = canvas.toDataURL('image/jpeg', 0.8);
          
          showNotification('Photo uploaded! üì∏');
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Image handling for wardrobe
    function handleWardrobeImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showNotification('Please select an image file', 'error');
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        showNotification('Image size must be less than 5MB', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          const canvas = document.getElementById('wardrobe-image-canvas');
          const ctx = canvas.getContext('2d');
          
          // Resize image to max 200px width for wardrobe thumbnails
          const maxWidth = 200;
          const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
          canvas.width = img.width * ratio;
          canvas.height = img.height * ratio;
          
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          wardrobeImage = canvas.toDataURL('image/jpeg', 0.8);
          
          showNotification('Wardrobe item photo uploaded! üì∏');
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Download image function
    function downloadImage(imageUrl, filename) {
      if (!imageUrl) {
        showNotification('No image to download', 'error');
        return;
      }

      const link = document.createElement('a');
      link.href = imageUrl;
      link.download = filename || 'outfit.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showNotification('Image downloaded! üì∏');
    }

    // Notification System
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type === 'error' ? 'error' : ''}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
      
      document.getElementById(`${tabName}-tab`).classList.add('active');
      event.target.closest('.nav-item').classList.add('active');
      currentTab = tabName;
      
      if (tabName === 'explore') {
        loadPosts();
        loadWeather();
      }
      if (tabName === 'shop') searchShop();
      if (tabName === 'profile') {
        loadWardrobe();
        loadOutfits();
        updateDashboard();
      }
      if (tabName === 'map') initMap();
      if (tabName === 'community') {
        loadCommunityContent();
        loadLeaderboards();
      }
      if (tabName === 'ai-dresser') {
        loadCalendar();
        loadTodaysOutfits();
      }
    }

    // Community content
    function loadCommunityContent() {
      // Load leaderboards
      loadLeaderboards();
    }

    function loadLeaderboards() {
      // Winners leaderboard based on star ratings from posts
      const userRatings = {};
      
      // Calculate user ratings from posts
      posts.forEach(post => {
        if (!userRatings[post.user]) {
          userRatings[post.user] = { totalStars: 0, postCount: 0 };
        }
        userRatings[post.user].totalStars += post.stars || 0;
        userRatings[post.user].postCount += 1;
      });
      
      // Convert to array and sort by total stars
      const winners = Object.entries(userRatings)
        .map(([name, data]) => ({
          name,
          totalStars: data.totalStars,
          postCount: data.postCount,
          avatar: name.charAt(0)
        }))
        .sort((a, b) => b.totalStars - a.totalStars)
        .slice(0, 5);

      const trendingStyles = [
        { name: "Kente Accessories", count: 234, icon: "üü®üü´" },
        { name: "Modern Dashiki", count: 189, icon: "üëî" },
        { name: "Beaded Jewelry", count: 167, icon: "üìø" },
        { name: "Ankara Blazers", count: 145, icon: "üß•" },
        { name: "Djellaba & Caftan", count: 98, icon: "ü•ª" }
      ];

      const winnersHtml = winners.map((user, index) => `
        <div class="leaderboard-item">
          <div class="rank ${index < 3 ? `rank-${index + 1}` : ''}">${index + 1}</div>
          <div class="avatar" style="width: 24px; height: 24px; font-size: 0.8rem;">${user.avatar}</div>
          <div style="flex: 1;">${user.name}</div>
          <div style="color: #888; font-size: 0.8rem;">${user.totalStars} ‚≠ê</div>
        </div>
      `).join('');

      const trendingHtml = trendingStyles.map((style, index) => `
        <div class="trending-item">
          <div class="trending-icon">${style.icon}</div>
          <div class="trending-name">${style.name}</div>
          <div class="trending-count">${style.count}</div>
        </div>
      `).join('');

      document.getElementById('winners-leaderboard').innerHTML = winnersHtml;
      document.getElementById('trending-styles').innerHTML = trendingHtml;
    }

    function showFullLeaderboard() {
      alert('Full leaderboard feature coming soon! üèÜ');
    }

    // API Functions
    async function apiCall(endpoint, method = 'GET', data = null) {
      try {
        const options = {
          method,
          headers: { 'Content-Type': 'application/json' }
        };
        if (data) options.body = JSON.stringify(data);
        
        const response = await fetch(`${API}${endpoint}`, options);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const result = await response.json();
        return result;
      } catch (error) {
        showNotification('Connection error', 'error');
        throw error;
      }
    }

    // Social Feed Functions
    async function loadPosts() {
      try {
        const data = await apiCall('/api/posts');
        posts = data.posts; // Update global posts array
        const container = document.getElementById('posts-container');
        
        if (data.posts.length === 0) {
          container.innerHTML = '<div class="empty-state"><h3>No posts yet</h3><p>Share your first outfit!</p></div>';
          return;
        }
        
        container.innerHTML = data.posts.map(post => `
          <div class="post">
            <div class="post-header">
              <div class="avatar">${post.user.charAt(0)}</div>
              <div>
                <div class="post-user">${post.user}</div>
                <div class="post-time">${timeAgo(post.created_at || Date.now())}</div>
              </div>
              ${post.user === currentUser?.name ? `
                <button class="btn small" onclick="editPost(${post.id})" style="margin-left: auto;">Edit</button>
              ` : ''}
            </div>
            <div class="post-image-container">
              ${post.image ? 
                `<img src="${post.image}" alt="Outfit" class="post-image">` : 
                `<div class="post-image">${getOutfitEmojis(post.outfit)}</div>`
              }
            </div>
            <div class="post-outfit">${post.outfit}</div>
            ${post.purchaseInfo ? `
              <div class="post-purchase">Bought from: <a href="#" onclick="filterShop('${post.purchaseInfo.toLowerCase()}')">${post.purchaseInfo}</a></div>
            ` : ''}
            <div class="post-actions">
              <div class="action-buttons">
                <div class="star-rating" id="rating-${post.id}">
                  ${[1,2,3,4,5].map(star => `
                    <span class="star ${post.stars >= star ? 'active' : ''}" 
                          onclick="ratePost(${post.id}, ${star})">‚≠ê</span>
                  `).join('')}
                </div>
                <button class="action-btn" onclick="toggleComments(${post.id})">üí¨</button>
                <button class="action-btn" onclick="downloadImage('${post.image}', 'outfit-${post.id}.jpg')">üì•</button>
              </div>
              <div class="post-stats">${post.stars || 0}‚≠ê ‚Ä¢ ${post.comments ? post.comments.length : 0} comments</div>
            </div>
            <div class="comments-section" id="comments-${post.id}" style="display: none;">
              ${post.comments && post.comments.length > 0 ? post.comments.map(comment => `
                <div class="comment">
                  <div class="comment-avatar">${comment.user.charAt(0)}</div>
                  <div class="comment-content">
                    <div class="comment-header">
                      <div class="comment-user">${comment.user}</div>
                      <div class="comment-time">${timeAgo(comment.created_at)}</div>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                  </div>
                </div>
              `).join('') : '<div style="text-align: center; color: #888; padding: 1rem;">No comments yet</div>'}
              <div class="add-comment">
                <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Add a comment...">
                <button class="comment-btn" onclick="addComment(${post.id})">Post</button>
              </div>
            </div>
            <div class="edit-post" id="edit-${post.id}" style="display: none;">
              <textarea class="edit-input" id="edit-outfit-${post.id}">${post.outfit}</textarea>
              <input type="text" class="edit-input" id="edit-purchase-${post.id}" value="${post.purchaseInfo || ''}" placeholder="Where did you buy these items?">
              <div class="edit-actions">
                <button class="btn secondary" onclick="cancelEdit(${post.id})">Cancel</button>
                <button class="btn" onclick="savePost(${post.id})">Save</button>
              </div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        document.getElementById('posts-container').innerHTML = '<div class="empty-state"><h3>Could not load posts</h3></div>';
      }
    }

    function editPost(postId) {
      document.getElementById(`edit-${postId}`).style.display = 'block';
    }

    function cancelEdit(postId) {
      document.getElementById(`edit-${postId}`).style.display = 'none';
    }

    async function savePost(postId) {
      const outfit = document.getElementById(`edit-outfit-${postId}`).value.trim();
      const purchaseInfo = document.getElementById(`edit-purchase-${postId}`).value.trim();
      
      if (!outfit) {
        showNotification('Outfit description cannot be empty', 'error');
        return;
      }
      
      try {
        // In a real app, this would call an API endpoint to update the post
        const post = posts.find(p => p.id === postId);
        if (post) {
          post.outfit = outfit;
          post.purchaseInfo = purchaseInfo || null;
        }
        
        showNotification('Post updated! ‚ú®');
        cancelEdit(postId);
        loadPosts();
      } catch (error) {
        showNotification('Failed to update post', 'error');
      }
    }

    function toggleComments(postId) {
      const commentsSection = document.getElementById(`comments-${postId}`);
      commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
    }

    async function addComment(postId) {
      const commentInput = document.getElementById(`comment-input-${postId}`);
      const commentText = commentInput.value.trim();
      
      if (!commentText) {
        showNotification('Please enter a comment', 'error');
        return;
      }

      try {
        await apiCall(`/api/posts/${postId}/comments`, 'POST', {
          user: currentUser.name,
          text: commentText
        });
        
        commentInput.value = '';
        showNotification('Comment added! üí¨');
        loadPosts();
      } catch (error) {
        showNotification('Failed to add comment', 'error');
      }
    }

    async function createPost() {
      const outfit = document.getElementById('outfit-input').value.trim();
      const purchaseInfo = document.getElementById('purchase-info').value.trim();
      
      if (!outfit) {
        showNotification('Please describe your outfit', 'error');
        return;
      }
      
      try {
        const postData = { 
          user: currentUser.name, 
          outfit: outfit,
          location: currentUser.location
        };
        
        if (selectedImage) {
          postData.image = selectedImage;
        }
        if (purchaseInfo) {
          postData.purchaseInfo = purchaseInfo;
        }
        
        await apiCall('/api/posts', 'POST', postData);
        
        document.getElementById('outfit-input').value = '';
        document.getElementById('purchase-info').value = '';
        selectedImage = null;
        document.getElementById('image-upload-input').value = '';
        showNotification('Outfit shared! üì∏');
        loadPosts();
      } catch (error) {
        showNotification('Failed to share outfit', 'error');
      }
    }

    async function ratePost(postId, stars) {
      try {
        await apiCall(`/api/posts/${postId}/rate`, 'POST', { stars: stars });
        
        let message = 'Rating removed';
        if (stars === 1) message = 'Rated 1 star ‚≠ê';
        else if (stars === 2) message = 'Rated 2 stars ‚≠ê‚≠ê';
        else if (stars === 3) message = 'Rated 3 stars ‚≠ê‚≠ê‚≠ê';
        else if (stars === 4) message = 'Rated 4 stars ‚≠ê‚≠ê‚≠ê‚≠ê';
        else if (stars === 5) message = 'Rated 5 stars ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
        
        showNotification(message);
        setTimeout(() => loadPosts(), 1000);
      } catch (error) {
        showNotification('Rating failed', 'error');
      }
    }

    // Wardrobe Functions
    async function loadWardrobe() {
      try {
        const data = await apiCall('/api/wardrobe');
        const container = document.getElementById('wardrobe-list');
        
        if (!data || !data.wardrobe || data.wardrobe.length === 0) {
          container.innerHTML = '<div class="empty-state"><h3>Empty wardrobe</h3><p>Add your first item!</p></div>';
          updateDashboard();
          return;
        }
        
        container.innerHTML = data.wardrobe.map(item => `
          <div class="wardrobe-item">
            ${item.image ? 
              `<img src="${item.image}" alt="${item.name}" class="item-image">` : 
              `<div class="item-icon">${item.icon || 'üëî'}</div>`
            }
            <div class="item-category">${getCategoryLabel(item.category)}</div>
            <div class="item-color">${item.color}</div>
            <div class="item-name">${item.name}</div>
            <div class="item-details">${getPriceLabel(item.price_band)}</div>
            ${item.worn_count > 0 ? `<div class="wear-count">Worn ${item.worn_count} times</div>` : ''}
            <button class="btn secondary small" onclick="deleteWardrobeItem(${item.id})" style="margin-top: 0.5rem;">Remove</button>
          </div>
        `).join('');

        // Update outfit creation dropdowns
        updateOutfitDropdowns(data.wardrobe);
        updateDashboard();
      } catch (error) {
        console.error('Error loading wardrobe:', error);
        document.getElementById('wardrobe-list').innerHTML = '<div class="empty-state"><h3>Could not load wardrobe</h3><p>Check your connection and try again.</p></div>';
      }
    }

    function getCategoryLabel(category) {
      const labels = {
        'top': 'üëï Top',
        'bottom': 'üëñ Bottom',
        'dress': 'üëó Dress',
        'shoes': 'üëü Shoes',
        'outerwear': 'üß• Outerwear',
        'cologne': 'üå¨Ô∏è Cologne',
        'accessory': 'üíé Accessory'
      };
      return labels[category] || category;
    }

    function getPriceLabel(priceBand) {
      const prices = { low: 'KES 1,500', medium: 'KES 4,000', high: 'KES 12,000' };
      return prices[priceBand] || 'KES 3,000';
    }

    function updateOutfitDropdowns(wardrobe) {
      const tops = wardrobe.filter(item => item.category === 'top');
      const bottoms = wardrobe.filter(item => item.category === 'bottom');
      const shoes = wardrobe.filter(item => item.category === 'shoes');
      const outerwear = wardrobe.filter(item => item.category === 'outerwear');
      const accessories = wardrobe.filter(item => item.category === 'accessory');
      const colognes = wardrobe.filter(item => item.category === 'cologne');

      updateDropdown('outfit-top', tops);
      updateDropdown('outfit-bottom', bottoms);
      updateDropdown('outfit-shoes', shoes);
      updateDropdown('outfit-outerwear', outerwear);
      updateDropdown('outfit-accessory', accessories);
      updateDropdown('outfit-cologne', colognes);
    }

    function updateDropdown(dropdownId, items) {
      const dropdown = document.getElementById(dropdownId);
      dropdown.innerHTML = `<option value="">Select ${dropdownId.split('-')[1]}</option>` +
        items.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
    }

    async function addWardrobeItem() {
      const name = document.getElementById('item-name').value.trim();
      const category = document.getElementById('item-category').value;
      const color = document.getElementById('item-color').value;
      
      if (!name) {
        showNotification('Please enter item name', 'error');
        return;
      }
      
      const icons = { 
        top: 'üëï', 
        bottom: 'üëñ', 
        dress: 'üëó', 
        shoes: 'üëü', 
        outerwear: 'üß•', 
        cologne: 'üå¨Ô∏è',
        accessory: 'üíé'
      };
      
      try {
        const itemData = {
          name,
          category,
          color,
          icon: icons[category],
          price_band: 'medium',
          worn_count: 0
        };
        
        if (wardrobeImage) {
          itemData.image = wardrobeImage;
        }
        
        await apiCall('/api/wardrobe', 'POST', itemData);
        
        document.getElementById('item-name').value = '';
        document.getElementById('item-category').value = 'top';
        document.getElementById('item-color').value = 'white';
        document.getElementById('wardrobe-image-upload').value = '';
        wardrobeImage = null;
        showNotification(`${icons[category]} ${name} added to wardrobe!`);
        loadWardrobe();
      } catch (error) {
        console.error('Error adding wardrobe item:', error);
        showNotification('Failed to add item', 'error');
      }
    }

    async function deleteWardrobeItem(itemId) {
      if (!confirm('Remove this item?')) return;
      
      try {
        await apiCall(`/api/wardrobe/${itemId}`, 'DELETE');
        showNotification('Item removed');
        loadWardrobe();
      } catch (error) {
        console.error('Error deleting wardrobe item:', error);
        showNotification('Failed to remove item', 'error');
      }
    }

    // Outfit Functions
    async function loadOutfits() {
      // Load outfits from localStorage
      const savedOutfits = localStorage.getItem(`outfits_${currentUser.name}`);
      userOutfits = savedOutfits ? JSON.parse(savedOutfits) : [];
      
      // Load scheduled outfits
      const savedScheduled = localStorage.getItem(`scheduled_${currentUser.name}`);
      scheduledOutfits = savedScheduled ? JSON.parse(savedScheduled) : {};
      
      displayOutfits();
    }

    function displayOutfits() {
      const container = document.getElementById('outfits-list');
      
      if (userOutfits.length === 0) {
        container.innerHTML = '<div class="empty-state"><h3>No outfits created yet</h3><p>Combine your wardrobe items to create outfits!</p></div>';
        return;
      }
      
      container.innerHTML = userOutfits.map(outfit => {
        const wearCount = outfit.wear_count || 0;
        return `
          <div class="outfit-combination">
            <div class="outfit-header">
              <div class="outfit-name">${outfit.name}</div>
              <div class="outfit-wear-count">Worn ${wearCount} times</div>
            </div>
            <div class="outfit-items">
              ${outfit.top ? `
                <div class="outfit-item">
                  ${outfit.topImage ? `<img src="${outfit.topImage}" alt="${outfit.top}" class="outfit-item-image">` : '<div class="item-icon">üëï</div>'}
                  <div class="outfit-item-name">${outfit.top}</div>
                  <div class="outfit-item-type">Top</div>
                </div>
              ` : ''}
              ${outfit.bottom ? `
                <div class="outfit-item">
                  ${outfit.bottomImage ? `<img src="${outfit.bottomImage}" alt="${outfit.bottom}" class="outfit-item-image">` : '<div class="item-icon">üëñ</div>'}
                  <div class="outfit-item-name">${outfit.bottom}</div>
                  <div class="outfit-item-type">Bottom</div>
                </div>
              ` : ''}
              ${outfit.shoes ? `
                <div class="outfit-item">
                  ${outfit.shoesImage ? `<img src="${outfit.shoesImage}" alt="${outfit.shoes}" class="outfit-item-image">` : '<div class="item-icon">üëü</div>'}
                  <div class="outfit-item-name">${outfit.shoes}</div>
                  <div class="outfit-item-type">Shoes</div>
                </div>
              ` : ''}
              ${outfit.outerwear ? `
                <div class="outfit-item">
                  ${outfit.outerwearImage ? `<img src="${outfit.outerwearImage}" alt="${outfit.outerwear}" class="outfit-item-image">` : '<div class="item-icon">üß•</div>'}
                  <div class="outfit-item-name">${outfit.outerwear}</div>
                  <div class="outfit-item-type">Outerwear</div>
                </div>
              ` : ''}
              ${outfit.accessory ? `
                <div class="outfit-item">
                  ${outfit.accessoryImage ? `<img src="${outfit.accessoryImage}" alt="${outfit.accessory}" class="outfit-item-image">` : '<div class="item-icon">üíé</div>'}
                  <div class="outfit-item-name">${outfit.accessory}</div>
                  <div class="outfit-item-type">Accessory</div>
                </div>
              ` : ''}
              ${outfit.cologne ? `
                <div class="outfit-item">
                  ${outfit.cologneImage ? `<img src="${outfit.cologneImage}" alt="${outfit.cologne}" class="outfit-item-image">` : '<div class="item-icon">üå¨Ô∏è</div>'}
                  <div class="outfit-item-name">${outfit.cologne}</div>
                  <div class="outfit-item-type">Cologne</div>
                </div>
              ` : ''}
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <button class="btn small" onclick="wearOutfit(${outfit.id})">Wear This</button>
              <button class="btn small secondary" onclick="scheduleOutfit(${outfit.id})">Schedule</button>
              <button class="btn small danger" onclick="deleteOutfit(${outfit.id})">Delete</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function createOutfit() {
      const topId = document.getElementById('outfit-top').value;
      const bottomId = document.getElementById('outfit-bottom').value;
      const shoesId = document.getElementById('outfit-shoes').value;
      const outerwearId = document.getElementById('outfit-outerwear').value;
      const accessoryId = document.getElementById('outfit-accessory').value;
      const cologneId = document.getElementById('outfit-cologne').value;
      const name = document.getElementById('outfit-name').value.trim();
      
      if (!topId || !bottomId || !shoesId || !name) {
        showNotification('Please select top, bottom, shoes and name the outfit', 'error');
        return;
      }

      // Get item details from wardrobe
      const wardrobeData = JSON.parse(localStorage.getItem('wardrobe') || '[]');
      
      const getItemDetails = (id) => {
        const item = wardrobeData.find(item => item.id == id);
        return item ? { name: item.name, image: item.image } : { name: 'Unknown', image: null };
      };

      const topDetails = getItemDetails(topId);
      const bottomDetails = getItemDetails(bottomId);
      const shoesDetails = getItemDetails(shoesId);
      const outerwearDetails = outerwearId ? getItemDetails(outerwearId) : null;
      const accessoryDetails = accessoryId ? getItemDetails(accessoryId) : null;
      const cologneDetails = cologneId ? getItemDetails(cologneId) : null;

      const outfit = {
        id: Date.now(),
        name: name,
        top: topDetails.name,
        topImage: topDetails.image,
        bottom: bottomDetails.name,
        bottomImage: bottomDetails.image,
        shoes: shoesDetails.name,
        shoesImage: shoesDetails.image,
        outerwear: outerwearDetails ? outerwearDetails.name : null,
        outerwearImage: outerwearDetails ? outerwearDetails.image : null,
        accessory: accessoryDetails ? accessoryDetails.name : null,
        accessoryImage: accessoryDetails ? accessoryDetails.image : null,
        cologne: cologneDetails ? cologneDetails.name : null,
        cologneImage: cologneDetails ? cologneDetails.image : null,
        created: new Date().toISOString(),
        wear_count: 0
      };

      userOutfits.push(outfit);
      localStorage.setItem(`outfits_${currentUser.name}`, JSON.stringify(userOutfits));
      
      showNotification(`Outfit "${name}" created! üëó`);
      displayOutfits();
      updateDashboard();
      
      // Reset form
      document.getElementById('outfit-name').value = '';
      document.getElementById('outfit-top').value = '';
      document.getElementById('outfit-bottom').value = '';
      document.getElementById('outfit-shoes').value = '';
      document.getElementById('outfit-outerwear').value = '';
      document.getElementById('outfit-accessory').value = '';
      document.getElementById('outfit-cologne').value = '';
    }

    function wearOutfit(outfitId) {
      const outfit = userOutfits.find(o => o.id === outfitId);
      if (outfit) {
        outfit.wear_count = (outfit.wear_count || 0) + 1;
        localStorage.setItem(`outfits_${currentUser.name}`, JSON.stringify(userOutfits));
        showNotification(`Wearing ${outfit.name} today! üëó`);
        displayOutfits();
      }
    }

    function scheduleOutfit(outfitId) {
      const outfit = userOutfits.find(o => o.id === outfitId);
      if (outfit) {
        const date = prompt('Enter date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
        if (date) {
          if (!scheduledOutfits[date]) {
            scheduledOutfits[date] = [];
          }
          scheduledOutfits[date].push(outfit);
          localStorage.setItem(`scheduled_${currentUser.name}`, JSON.stringify(scheduledOutfits));
          showNotification(`Scheduled ${outfit.name} for ${date}! üìÖ`);
          loadCalendar();
        }
      }
    }

    function deleteOutfit(outfitId) {
      userOutfits = userOutfits.filter(outfit => outfit.id !== outfitId);
      localStorage.setItem(`outfits_${currentUser.name}`, JSON.stringify(userOutfits));
      showNotification('Outfit deleted');
      displayOutfits();
      updateDashboard();
    }

    function updateDashboard() {
      const wardrobeData = JSON.parse(localStorage.getItem('wardrobe') || '[]');
      document.getElementById('total-items').textContent = wardrobeData.length;
      document.getElementById('total-outfits').textContent = userOutfits.length;
    }

    // Calendar Functions
    function loadCalendar() {
      const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
      
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDay = firstDay.getDay();
      
      let calendarHTML = '';
      
      // Add empty cells for days before the first day of the month
      for (let i = 0; i < startingDay; i++) {
        calendarHTML += '<div class="calendar-day"></div>';
      }
      
      // Add days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const hasEvent = scheduledOutfits[dateStr] && scheduledOutfits[dateStr].length > 0;
        
        calendarHTML += `
          <div class="calendar-day ${hasEvent ? 'has-event' : ''}" onclick="viewDayOutfits('${dateStr}')">
            <div class="day-number">${day}</div>
            ${hasEvent ? '<div class="event-dot"></div>' : ''}
          </div>
        `;
      }
      
      document.getElementById('calendar-grid').innerHTML = calendarHTML;
    }

    function previousMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      loadCalendar();
    }

    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      loadCalendar();
    }

    function viewDayOutfits(dateStr) {
      const outfits = scheduledOutfits[dateStr] || [];
      if (outfits.length > 0) {
        let outfitsHTML = '<h4>Outfits for ' + dateStr + '</h4>';
        outfits.forEach(outfit => {
          outfitsHTML += `
            <div class="scheduled-outfit">
              <span>${outfit.name}</span>
              <button class="btn small danger" onclick="removeScheduledOutfit('${dateStr}', ${outfit.id})">Remove</button>
            </div>
          `;
        });
        document.getElementById('todays-outfits').innerHTML = outfitsHTML;
      } else {
        document.getElementById('todays-outfits').innerHTML = '<p>No outfits scheduled for this day.</p>';
      }
    }

    function removeScheduledOutfit(dateStr, outfitId) {
      if (scheduledOutfits[dateStr]) {
        scheduledOutfits[dateStr] = scheduledOutfits[dateStr].filter(o => o.id !== outfitId);
        if (scheduledOutfits[dateStr].length === 0) {
          delete scheduledOutfits[dateStr];
        }
        localStorage.setItem(`scheduled_${currentUser.name}`, JSON.stringify(scheduledOutfits));
        showNotification('Outfit removed from schedule');
        loadCalendar();
        loadTodaysOutfits();
      }
    }

    function loadTodaysOutfits() {
      const today = new Date().toISOString().split('T')[0];
      viewDayOutfits(today);
    }

    // AI Recommendations
    async function getAIRecommendation() {
      try {
        const occasion = document.getElementById('occasion').value;
        
        const params = new URLSearchParams({ 
          occasion: occasion,
          location: currentUser.location 
        });
        
        const data = await apiCall(`/api/dresser?${params}`);
        
        // Add cologne suggestion
        const wardrobeData = JSON.parse(localStorage.getItem('wardrobe') || '[]');
        const colognes = wardrobeData.filter(item => item.category === 'cologne');
        let cologneSuggestion = '';
        
        if (colognes.length > 0) {
          const randomCologne = colognes[Math.floor(Math.random() * colognes.length)];
          cologneSuggestion = ` Complete your look with ${randomCologne.name} cologne.`;
        } else {
          cologneSuggestion = ' Consider adding a cologne to complete your outfit.';
        }
        
        document.getElementById('ai-result').innerHTML = `
          <div class="ai-suggestion">
            <h3>‚ú® Perfect Outfit for ${occasion.charAt(0).toUpperCase() + occasion.slice(1)}</h3>
            <div class="suggestion-outfit">${data.outfit}${cologneSuggestion}</div>
            <div class="suggestion-tip">üí° ${data.tip}</div>
            <button class="btn secondary" onclick="getAIRecommendation()" style="margin-top: 1rem;">New Suggestion</button>
          </div>
        `;
      } catch (error) {
        console.error('Error getting AI recommendation:', error);
        document.getElementById('ai-result').innerHTML = `
          <div class="ai-suggestion">
            <h3>ü§ñ Need more items!</h3>
            <div class="suggestion-outfit">Add more clothes to your wardrobe for better suggestions</div>
            <div class="suggestion-tip">üí° Try adding tops, bottoms, shoes, and accessories</div>
          </div>
        `;
      }
    }

    async function getShopSuggestions() {
      const occasion = document.getElementById('shop-occasion').value;
      const weather = document.getElementById('shop-weather').value;
      
      // Filter shop items based on occasion and weather
      let suggestions = [];
      
      if (weather === 'hot') {
        suggestions = suggestions.concat(getHeritageItems('dashiki'));
        suggestions = suggestions.concat(getHeritageItems('djellaba'));
      }
      if (occasion === 'cultural') {
        suggestions = suggestions.concat(getHeritageItems('kente'));
        suggestions = suggestions.concat(getHeritageItems('ankara'));
      }
      if (occasion === 'work') {
        suggestions = suggestions.concat(getHeritageItems('ankara'));
      }
      if (occasion === 'date' || occasion === 'event') {
        suggestions = suggestions.concat(getHeritageItems('djellaba'));
        suggestions = suggestions.concat(getHeritageItems('cologne'));
      }
      
      const container = document.getElementById('shop-suggestions');
      if (suggestions.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No suggestions found</p></div>';
        return;
      }
      
      container.innerHTML = suggestions.map(item => `
        <div class="shop-item">
          ${item.image ? 
            `<img src="${item.image}" alt="${item.name}" class="shop-item-image">` : 
            `<div class="shop-icon">${item.icon}</div>`
          }
          <div class="shop-name">${item.name}</div>
          <div class="shop-price">KES ${getPriceFromBand(item.price_band)}</div>
          <div class="shop-store">${item.merchant}</div>
          <button class="btn small" onclick="buyItem('${item.name}', '${item.icon}', '${item.category}', '${item.price_band}', '${item.image || ''}')" style="width: 100%; margin-top: 0.5rem;">Add to Wardrobe</button>
        </div>
      `).join('');
    }

    // Shop Functions
    function filterShop(category) {
      currentShopFilter = category;
      
      // Update active category
      document.querySelectorAll('.category-card').forEach(card => card.classList.remove('active'));
      event.target.closest('.category-card')?.classList.add('active');
      
      searchShop();
    }

    async function searchShop() {
      try {
        const searchTerm = document.getElementById('search-input')?.value || '';
        const params = new URLSearchParams({ region: currentUser?.location || 'Nairobi' });
        if (currentShopFilter !== 'all') params.set('category', currentShopFilter);
        
        // Get regular shop data
        const data = await apiCall(`/api/shops/search?${params}`);
        let results = data.results || [];
        
        // Add African heritage items based on filter
        if (currentShopFilter === 'kente' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('kente'));
        }
        if (currentShopFilter === 'dashiki' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('dashiki'));
        }
        if (currentShopFilter === 'ankara' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('ankara'));
        }
        if (currentShopFilter === 'djellaba' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('djellaba'));
        }
        if (currentShopFilter === 'jewelry' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('jewelry'));
        }
        if (currentShopFilter === 'cologne' || currentShopFilter === 'all') {
          results = results.concat(getHeritageItems('cologne'));
        }
        
        // Filter by search term
        if (searchTerm) {
          results = results.filter(item => 
            item.name.toLowerCase().includes(searchTerm.toLowerCase())
          );
        }
        
        const container = document.getElementById('shop-results');
        
        if (!results || results.length === 0) {
          container.innerHTML = '<div class="empty-state"><h3>No items found</h3><p>Try a different search or category.</p></div>';
          return;
        }
        
        container.innerHTML = results.map(item => `
          <div class="shop-item">
            ${item.image ? 
              `<img src="${item.image}" alt="${item.name}" class="shop-item-image">` : 
              `<div class="shop-icon">${item.icon}</div>`
            }
            <div class="shop-name">${item.name}</div>
            <div class="shop-price">KES ${getPriceFromBand(item.price_band)}</div>
            <div class="shop-store">${item.merchant}</div>
            <button class="btn small" onclick="buyItem('${item.name}', '${item.icon}', '${item.category}', '${item.price_band}', '${item.image || ''}')" style="width: 100%; margin-top: 0.5rem;">Add to Wardrobe</button>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error searching shop:', error);
        document.getElementById('shop-results').innerHTML = '<div class="empty-state"><h3>Could not load shop items</h3><p>Check your connection and try again.</p></div>';
      }
    }

    function getHeritageItems(type) {
      const heritageItems = {
        "kente": [
            {"name": "Traditional Kente Headband", "icon": "üéÄ", "category": "accessory", "price_band": "medium", "merchant": "African Heritage Store", "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTBj4ooh580p9xkFN3LtclZ1XEg-SvDaXxAFw&s"},
            {"name": "Kente Print Bow Tie", "icon": "üéóÔ∏è", "category": "accessory", "price_band": "low", "merchant": "Cultural Fashion Hub", "image": "https://sonson.com/cdn/shop/products/StreetArt_RemovedBackground_2.jpg?v=1682190419"},
            {"name": "Kente Woven Belt", "icon": "üè∑Ô∏è", "category": "accessory", "price_band": "medium", "merchant": "Ghana Imports KE", "image": "https://ribbonbydesign.com/cdn/shop/files/kente_style_pattern-1_C__64804.1683049337.1280.1280.jpg?v=1691931775&width=1445"}
        ],
        "dashiki": [
            {"name": "Modern Dashiki Shirt", "icon": "üëî", "category": "top", "price_band": "medium", "merchant": "Afrocentric Styles", "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSxxKn4ViDHq-6eLrDraDwXcXIx2m_eS4DhdQ&s"},
            {"name": "Dashiki Print Blouse", "icon": "üëö", "category": "top", "price_band": "medium", "merchant": "Ubuntu Fashion", "image": "https://m.media-amazon.com/images/I/719O--kiRlL._UY1000_.jpg"},
            {"name": "Contemporary Dashiki Dress", "icon": "üëó", "category": "dress", "price_band": "high", "merchant": "African Elegance", "image": "https://lh6.googleusercontent.com/proxy/zWcCDaGahniOhm3lZp6DMjz1YjEnM9yIOCtd6FtpTjwFpFV7my_vOpFb-s8ByZGhBfOFe7vBMJBpXgsK_45oaLCn9AJDnYYW65y1_CcC1YyJ"}
        ],
        "ankara": [
            {"name": "Ankara Print Blazer", "icon": "üß•", "category": "outerwear", "price_band": "high", "merchant": "Ankara Couture", "image": "https://kipfashion.com/wp-content/uploads/2020/06/Ankara-print-Denzel-Blazer.png"},
            {"name": "Ankara Business Jacket", "icon": "üß•", "category": "outerwear", "price_band": "high", "merchant": "Professional African Wear", "image": "https://ophclothing.com/storage/2021/08/8729.jpg"},
            {"name": "Ankara Casual Blazer", "icon": "üß•", "category": "outerwear", "price_band": "medium", "merchant": "Modern African Fashion", "image": "https://i0.wp.com/kipfashion.com/wp-content/uploads/2020/06/Ankara-print-Men-blazer.png?fit=580%2C577&ssl=1"}
        ],
        "djellaba": [
            {"name": "Traditional Djellaba", "icon": "ü•ª", "category": "dress", "price_band": "medium", "merchant": "North African Styles", "image": "https://thedjellaba.com/cdn/shop/files/djellaba-royale-witgoud-897922.jpg?v=1737094418"},
            {"name": "Embroidered Caftan", "icon": "ü•ª", "category": "dress", "price_band": "high", "merchant": "Moroccan Elegance", "image": "https://momonewyork.com/cdn/shop/products/bella-flor-embroidered-caftan-x-free-people-momo-new-york-949785_1080x.jpg?v=1672118916"},
            {"name": "Modern Caftan Dress", "icon": "üëó", "category": "dress", "price_band": "medium", "merchant": "Contemporary African", "image": "https://miss-burkini.com/cdn/shop/files/CaftanmoderneSafiya_5dda4518-0218-4751-9875-91919c53d0d2.png?v=1741176345"}
        ],
        "jewelry": [
            {"name": "Maasai Beaded Necklace", "icon": "üìø", "category": "accessory", "price_band": "medium", "merchant": "Maasai Crafts Collective", "image": "https://i.pinimg.com/736x/43/0f/2e/430f2e3534c2538bf36a5127d9bd87db.jpg"},
            {"name": "Traditional Beaded Bracelet", "icon": "üíé", "category": "accessory", "price_band": "low", "merchant": "Handmade Kenya", "image": "https://www.themaasaimarket.com/4794-large_default/milele-maasai-bracelet-blues.jpg"},
            {"name": "Ethnic Beaded Earrings", "icon": "üíç", "category": "accessory", "price_band": "low", "merchant": "Cultural Jewelry Store", "image": "https://m.media-amazon.com/images/I/81rj0UIm6fL._UF1000,1000_QL80_.jpg"}
        ],
        "cologne": [
            {"name": "Safari Essence Cologne", "icon": "üå¨Ô∏è", "category": "cologne", "price_band": "medium", "merchant": "African Scents", "image": "https://perfume-essence.com/media/catalog/product/cache/9110975d72d9707b7bc93e05e75366a6/s/a/safari_for_men.jpg"},
            {"name": "Nile Breeze Fragrance", "icon": "üå¨Ô∏è", "category": "cologne", "price_band": "high", "merchant": "Luxury Scents KE", "image": "https://hijaz.com/cdn/shop/products/blue-nile-alcohol-free-cologne-scented-body-oil-perfume-577944_1200x.jpg?v=1665592864"},
            {"name": "Savanna Mist Cologne", "icon": "üå¨Ô∏è", "category": "cologne", "price_band": "medium", "merchant": "Modern Fragrances", "image": "https://shop.rainafrica.co.za/cdn/shop/files/Savannah_Mist.jpg?v=1746030680"}
        ]
      };
      
      return heritageItems[type] || [];
    }

    async function addShopItem() {
      if (!isMerchant) {
        showNotification('Only merchants can add items', 'error');
        return;
      }

      const name = document.getElementById('new-item-name').value.trim();
      const category = document.getElementById('new-item-category').value;
      const price_band = document.getElementById('new-item-price').value;

      if (!name) {
        showNotification('Please enter item name', 'error');
        return;
      }

      // In a real app, this would call a merchant API endpoint
      showNotification(`Item "${name}" added to shop! üõçÔ∏è`);
      
      // Clear form
      document.getElementById('new-item-name').value = '';
      document.getElementById('new-item-category').value = 'top';
      document.getElementById('new-item-price').value = 'medium';
    }

    async function buyItem(name, icon, category, price_band, image = '') {
      try {
        const itemData = {
          name,
          icon,
          category,
          price_band,
          color: 'neutral',
          image: image,
          worn_count: 0
        };
        
        await apiCall('/api/wardrobe', 'POST', itemData);
        
        showNotification(`${icon} ${name} added to wardrobe!`);
        loadWardrobe();
      } catch (error) {
        console.error('Error buying item:', error);
        showNotification('Purchase successful! Item added to wardrobe. üõçÔ∏è');
        // Fallback: Add to local storage
        const wardrobeData = JSON.parse(localStorage.getItem('wardrobe') || '[]');
        const newItem = {
          id: Date.now(),
          ...itemData
        };
        wardrobeData.push(newItem);
        localStorage.setItem('wardrobe', JSON.stringify(wardrobeData));
        loadWardrobe();
      }
    }

    // Map Functions
    function initMap() {
      // Initialize Leaflet map
      if (map) {
        map.remove();
      }
      
      map = L.map('map-view').setView([-1.2921, 36.8219], 6); // Centered on Kenya
      
      // Add tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      
      // Add user markers
      addUserMarkers();
      
      // Add click event for new locations
      map.on('click', function(e) {
        addCustomLocation(e.latlng.lat, e.latlng.lng);
      });
    }

    function addUserMarkers() {
      // Sample users with different locations
      const users = [
        { name: "Alex", initial: "A", location: "Nairobi", lat: -1.2921, lng: 36.8219, outfit: "Casual Friday look with denim" },
        { name: "Sarah", initial: "S", location: "Mombasa", lat: -4.0435, lng: 39.6682, outfit: "Beach vibes with flowy dress" },
        { name: "Mike", initial: "M", location: "Kisumu", lat: -0.0917, lng: 34.7680, outfit: "Smart casual for work meeting" },
        { name: "Grace", initial: "G", location: "Nakuru", lat: -0.3031, lng: 36.0800, outfit: "Traditional dashiki for cultural event" },
        { name: "John", initial: "J", location: "Eldoret", lat: 0.5143, lng: 35.2698, outfit: "Athletic wear for morning run" }
      ];
      
      // Add current user
      if (currentUser) {
        users.push({
          name: currentUser.name,
          initial: currentUser.initial,
          location: currentUser.location,
          lat: currentUser.lat,
          lng: currentUser.lng,
          outfit: "Your latest outfit post"
        });
      }
      
      // Add custom locations
      const savedLocations = localStorage.getItem(`locations_${currentUser.name}`);
      customLocations = savedLocations ? JSON.parse(savedLocations) : [];
      
      users.forEach(user => {
        const marker = L.marker([user.lat, user.lng]).addTo(map);
        marker.bindPopup(`
          <b>${user.name}</b><br>
          üìç ${user.location}<br>
          üëî ${user.outfit}
        `);
      });
      
      // Add custom locations
      customLocations.forEach(location => {
        const marker = L.marker([location.lat, location.lng]).addTo(map);
        marker.bindPopup(`
          <b>${currentUser.name}</b><br>
          üìç ${location.caption || 'Custom Location'}<br>
          <button class="delete-marker-btn" onclick="deleteCustomLocation(${location.id})">Delete Marker</button>
        `);
      });
    }

    function addNewLocation() {
      showNotification('Click anywhere on the map to add a new location! üó∫Ô∏è');
    }

    function addCustomLocation(lat, lng) {
      const caption = prompt('Add a caption for this location:') || 'My favorite spot';
      
      const location = {
        id: Date.now(),
        caption: caption,
        lat: lat,
        lng: lng,
        addedBy: currentUser.name,
        addedAt: new Date().toISOString()
      };
      
      customLocations.push(location);
      localStorage.setItem(`locations_${currentUser.name}`, JSON.stringify(customLocations));
      
      // Add marker to map
      const marker = L.marker([lat, lng]).addTo(map);
      marker.bindPopup(`
        <b>${currentUser.name}</b><br>
        üìç ${caption}<br>
        <button class="delete-marker-btn" onclick="deleteCustomLocation(${location.id})">Delete Marker</button>
      `);
      
      showNotification(`Location "${caption}" added! üìç`);
    }

    function deleteCustomLocation(locationId) {
      customLocations = customLocations.filter(loc => loc.id !== locationId);
      localStorage.setItem(`locations_${currentUser.name}`, JSON.stringify(customLocations));
      initMap(); // Refresh map
      showNotification('Location marker deleted');
    }

    // Utility Functions
    function timeAgo(timestamp) {
      const now = new Date();
      const time = new Date(timestamp);
      const diff = Math.floor((now - time) / 1000);
      
      if (diff < 60) return 'just now';
      if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
      if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
      return Math.floor(diff / 86400) + 'd ago';
    }

    function getOutfitEmojis(outfit) {
      const emojis = outfit.match(/[üëîüëïüëñüëóüß•üëüüë†ü©¥üëûüß¶üå¨Ô∏è]/g);
      return emojis ? emojis.slice(0, 3).join('') : 'üëî‚ú®';
    }

    function getPriceFromBand(band) {
      const prices = { low: '1,500', medium: '4,000', high: '12,000' };
      return prices[band] || '3,000';
    }

    // Initialize
    async function loadInitialData() {
      showLoadingScreen();
      await loadPosts();
      await loadWardrobe();
      await loadOutfits();
      await loadWeather();
      updateDashboard();
      setTimeout(hideLoadingScreen, 2000);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        if (e.target.id === 'item-name') addWardrobeItem();
        if (e.target.id === 'search-input') searchShop();
      }
    });

    // Auto-resize textarea
    document.addEventListener('input', function(e) {
      if (e.target.tagName === 'TEXTAREA') {
        e.target.style.height = 'auto';
        e.target.style.height = e.target.scrollHeight + 'px';
      }
    });

    // Initialize app when page loads
    document.addEventListener('DOMContentLoaded', function() {
      showLoadingScreen();
      // Set initial shop filter
      currentShopFilter = 'all';
      setTimeout(hideLoadingScreen, 2000);
    });
  </script>
</body>
</html>